<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VLSI AI Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #f8f7f4;
        }
        .live-bg {
            position: fixed;
            left: 0; top: 0;
            width: 100vw; height: 100vh;
            z-index: 0;
            pointer-events: none;
        }
        .app-content {
            position: relative;
            z-index: 10;
        }
        .container {
            max-width: 1000px;
        }
        .tab-panel { min-height: 320px;}
        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 1000;
            display: none;
            text-align: center;
        }
        .message-box.show {
            display: block;
        }
        .sidebar {
            width: 220px;
            min-height: 620px;
        }
        .chat-history-list {
            max-height: 220px;
            overflow-y: auto;
        }
        .tab-description {
            font-size: .93rem;
            margin-bottom: 6px;
            color: #6b7280;
        }
        /* Hide file input text */
        .file-input {
            display: none;
        }
        /* Small bottom tabs */
        .bottom-tabs {
            position: absolute;
            bottom: 24px; left: 16px;
            display: flex; flex-direction: column; gap: 12px; z-index:20;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen app-content">
    <canvas id="liveBg" class="live-bg"></canvas>
    <div class="message-box bg-red-100 text-red-800" id="messageBox"></div>
    <div class="container mx-auto bg-white rounded-xl shadow-lg flex app-content" style="min-height:600px;">
        <!-- Sidebar -->
        <div class="sidebar bg-white rounded-l-xl p-4 border-r border-gray-200 flex flex-col justify-between" style="min-width:215px;">
            <div>
                <h2 class="text-lg font-bold text-gray-700 mb-2">Chat History</h2>
                <ul class="chat-history-list" id="chatHistoryList"></ul>
            </div>
            <div class="bottom-tabs">
                <button id="helpTab" class="bg-gray-200 text-gray-700 px-3 py-2 rounded-md font-medium text-sm hover:bg-blue-100">
                    Help
                </button>
                <button id="contactTab" class="bg-gray-200 text-gray-700 px-3 py-2 rounded-md font-medium text-sm hover:bg-green-100">
                    Contact
                </button>
            </div>
        </div>
        <!-- Main Content Area -->
        <div class="flex-1 px-8 py-8 app-content">
            <h1 class="text-3xl font-bold text-gray-800 mb-3 text-center">VLSI AI Assistant</h1>
            <p class="text-gray-600 mb-4 text-center">Your unified VLSI design partner‚Äîconcepts, logs, code, optimization, diagrams, and reporting.</p>
            <!-- Tabs -->
            <div class="flex space-x-2 border-b border-gray-200 mb-6">
                <button class="tab-button w-1/5 py-2 text-sm font-medium text-gray-700 border-b-2 border-transparent" id="tab-vlsi">VLSI Q&A</button>
                <button class="tab-button w-1/5 py-2 text-sm font-medium text-gray-700 border-b-2 border-transparent" id="tab-log">Log Analyzer</button>
                <button class="tab-button w-1/5 py-2 text-sm font-medium text-gray-700 border-b-2 border-transparent" id="tab-code">Code Gen/Optimizer</button>
                <button class="tab-button w-1/5 py-2 text-sm font-medium text-gray-700 border-b-2 border-transparent" id="tab-report">Report Summarizer</button>
                <button class="tab-button w-1/5 py-2 text-sm font-medium text-gray-700 border-b-2 border-transparent" id="tab-diagram">Diagram Generator</button>
            </div>
            <!-- Panels -->
            <!-- VLSI Q&A -->
            <div id="panel-vlsi" class="tab-panel">
                <div class="tab-description">Ask about any VLSI concept (e.g., "What is VLSI?", "Explain DV?"). Attach images/PDFs or use your voice for queries.</div>
                <textarea id="vlsiInput" rows="5" class="w-full p-3 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg mb-2"></textarea>
                <input type="file" id="vlsiFileInput" class="file-input" accept="image/*,.pdf">
                <div class="flex items-center space-x-2 mb-4">
                    <button id="vlsiMicBtn" class="bg-blue-500 text-white px-3 py-1 rounded-lg text-sm">üé§ Speak</button>
                    <label for="vlsiFileInput" class="bg-gray-100 border px-3 py-1 rounded-lg text-sm cursor-pointer">üìÅ Attach</label>
                </div>
                <div class="flex">
                    <button id="vlsiSubmitBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">Ask ‚ú®</button>
                </div>
            </div>
            <!-- Log Analyzer -->
            <div id="panel-log" class="tab-panel hidden">
                <div class="tab-description">Paste your VLSI tool log. Get a simple breakdown of errors, warnings, plus actionable fixes. Add extra context via attachments or speech if needed.</div>
                <textarea id="logInput" rows="7" class="w-full p-3 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg mb-2"></textarea>
                <input type="file" id="logFileInput" class="file-input" accept="image/*,.pdf">
                <div class="flex items-center space-x-2 mb-4">
                    <button id="logMicBtn" class="bg-blue-500 text-white px-3 py-1 rounded-lg text-sm">üé§ Speak</button>
                    <label for="logFileInput" class="bg-gray-100 border px-3 py-1 rounded-lg text-sm cursor-pointer">üìÅ Attach</label>
                </div>
                <div class="flex">
                    <button id="analyzeLogButton" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">Analyze Log ‚ú®</button>
                </div>
            </div>
            <!-- Code Gen/Optimizer-->
            <div id="panel-code" class="tab-panel hidden">
                <div class="tab-description">Paste Verilog/VHDL for analysis and optimization, or describe/design to generate fresh code. Attach diagrams/docs or speak your intent if desired.</div>
                <textarea id="codeInput" rows="7" class="w-full p-3 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg mb-2"></textarea>
                <input type="file" id="codeFileInput" class="file-input" accept="image/*,.pdf">
                <div class="flex items-center space-x-2 mb-4">
                    <button id="codeMicBtn" class="bg-purple-500 text-white px-3 py-1 rounded-lg text-sm">üé§ Speak</button>
                    <label for="codeFileInput" class="bg-gray-100 border px-3 py-1 rounded-lg text-sm cursor-pointer">üìÅ Attach</label>
                </div>
                <div class="flex space-x-2">
                    <button id="optimizeCodeButton" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-50">Optimize Code ‚ú®</button>
                    <button id="generateCodeButton" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50">Generate Code ‚ú®</button>
                </div>
            </div>
            <!-- Report Summarizer -->
            <div id="panel-report" class="tab-panel hidden">
                <div class="tab-description">Paste a timing/power report or attach details. Receive concise, clear summaries with all crucial metrics and violations cited from their sources.</div>
                <textarea id="reportInput" rows="7" class="w-full p-3 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg mb-2"></textarea>
                <input type="file" id="reportFileInput" class="file-input" accept="image/*,.pdf">
                <div class="flex items-center space-x-2 mb-4">
                    <button id="reportMicBtn" class="bg-green-500 text-white px-3 py-1 rounded-lg text-sm">üé§ Speak</button>
                    <label for="reportFileInput" class="bg-gray-100 border px-3 py-1 rounded-lg text-sm cursor-pointer">üìÅ Attach</label>
                </div>
                <div class="flex">
                    <button id="summarizeReportButton" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50">Summarize Report ‚ú®</button>
                </div>
            </div>
            <!-- Diagram Generator -->
            <div id="panel-diagram" class="tab-panel hidden">
                <div class="tab-description">Describe or upload a VLSI block/circuit diagram. The assistant generates or explains diagrams to help your understanding.</div>
                <textarea id="diagramInput" rows="5" class="w-full p-3 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg mb-2"></textarea>
                <input type="file" id="diagramFileInput" class="file-input" accept="image/*,.pdf">
                <div class="flex items-center space-x-2 mb-4">
                    <button id="diagramMicBtn" class="bg-yellow-500 text-white px-3 py-1 rounded-lg text-sm">üé§ Speak</button>
                    <label for="diagramFileInput" class="bg-gray-100 border px-3 py-1 rounded-lg text-sm cursor-pointer">üìÅ Attach</label>
                </div>
                <div class="flex">
                    <button id="diagramGenBtn" class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-6 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-opacity-50">Generate Diagram ‚ú®</button>
                </div>
            </div>
            <!-- Loading Indicator -->
            <div id="loadingIndicator" class="hidden flex items-center justify-center space-x-2 text-gray-600 mb-6">
                <svg class="animate-spin h-5 w-5 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span>Analyzing...</span>
            </div>
            <!-- Result Block -->
            <div id="resultContainer" class="hidden mt-8 p-6 bg-gray-50 rounded-lg border border-gray-200">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Analysis Result</h2>
                <div id="analysisOutput" class="prose max-w-none text-gray-700 leading-relaxed"></div>
            </div>
            <!-- Help Popup -->
            <div id="helpPopup" class="hidden fixed bottom-12 left-24 bg-white p-6 rounded-lg shadow-2xl border border-gray-300 max-w-xs z-50">
                <h3 class="text-lg font-bold mb-2 text-blue-800">Help</h3>
                <ul class="list-disc text-sm pl-4 text-gray-700">
                    <li>Switch tabs left for Concept, Logs, Code, Reports, Diagrams</li>
                    <li>Attach files or speak on any tab for quick input</li>
                    <li>Click any chat to restore prior answer‚Äîhistory saved for your session</li>
                    <li>Each answer includes its source website for full credibility</li>
                    <li>Contact below for further assistance</li>
                </ul>
                <div class="mt-2 text-right">
                    <button id="closeHelpBtn" class="bg-blue-200 text-blue-700 text-sm px-2 py-1 rounded">Close</button>
                </div>
            </div>
            <!-- Contact Popup -->
            <div id="contactPopup" class="hidden fixed bottom-12 left-44 bg-white p-6 rounded-lg shadow-2xl border border-gray-300 max-w-xs z-50">
                <h3 class="text-lg font-bold mb-2 text-green-800">Contact</h3>
                <div class="text-sm text-gray-700">
                    <div><span class="font-semibold">Name:</span> Rahul Deshpande</div>
                    <div><span class="font-semibold">Email:</span> rahul.deshpande@vlsitech.com</div>
                    <div class="mt-2 text-xs italic">All queries handled professionally by our VLSI support team.</div>
                </div>
                <div class="mt-2 text-right">
                    <button id="closeContactBtn" class="bg-green-200 text-green-700 text-sm px-2 py-1 rounded">Close</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        // Live Background
        function animateBalls() {
            const canvas = document.getElementById('liveBg');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            let w = window.innerWidth, h = window.innerHeight;
            canvas.width = w; canvas.height = h;

            let balls = [];
            const colors = [
                [255, 99, 71],   // red
                [65, 105, 225],  // blue
                [60, 179, 113],  // green
                [255, 168, 0],   // yellow
                [148, 0, 211],   // purple
            ];
            // Ball count and config
            for (let i = 0; i < 8; i++) {
                balls.push({
                    x: Math.random() * w,
                    y: Math.random() * h,
                    r: 60 + Math.random() * 50,
                    c: colors[i % colors.length],
                    dx: 2 + Math.random() * 2,
                    dy: 2 + Math.random() * 2,
                    hue: Math.random() * 360
                });
            }

            function draw() {
                ctx.clearRect(0, 0, w, h);
                for (let b of balls) {
                    b.x += b.dx * (Math.random() < 0.5 ? 1 : -1);
                    b.y += b.dy * (Math.random() < 0.5 ? 1 : -1);
                    b.hue += .4;
                    if (b.x < 0 || b.x > w) b.dx *= -1;
                    if (b.y < 0 || b.y > h) b.dy *= -1;
                    ctx.save();
                    ctx.globalAlpha = 0.44;
                    ctx.beginPath();
                    ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2);
                    ctx.fillStyle = `hsl(${b.hue % 360},56%,${85-(b.r/2)%30}%)`;
                    ctx.fill();
                    ctx.restore();
                }
            }
            function animate() {
                draw();
                requestAnimationFrame(animate);
            }
            animate();
        }
        window.addEventListener('resize', animateBalls);
        window.addEventListener('DOMContentLoaded', animateBalls);

        // Main App JS
        document.addEventListener('DOMContentLoaded', () => {
            // Tabs logic
            const tabs = document.querySelectorAll('.tab-button');
            const panels = document.querySelectorAll('.tab-panel');
            function switchTab(panelId) {
                tabs.forEach(tab => tab.classList.remove('border-blue-600'));
                panels.forEach(panel => panel.classList.add('hidden'));
                document.getElementById('tab-' + panelId).classList.add('border-blue-600');
                document.getElementById('panel-' + panelId).classList.remove('hidden');
            }
            tabs.forEach(tab => {
                tab.addEventListener('click', e => switchTab(e.target.id.replace('tab-','')));
            });
            switchTab('vlsi');

            // Message box
            const messageBox = document.getElementById('messageBox');
            function showMessage(msg, type='error') {
                messageBox.textContent = msg;
                messageBox.className = 'message-box show ' + (type==='error' ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800');
                setTimeout(() => { messageBox.classList.remove('show'); }, 5300);
            }

            // Chat History
            const chatHistoryList = document.getElementById('chatHistoryList');
            let chatHistory = JSON.parse(localStorage.getItem('vlsiChatHistory') || "[]");
            function updateChatHistory() {
                chatHistoryList.innerHTML = '';
                chatHistory.forEach((item, idx) => {
                    const li = document.createElement('li');
                    li.className = "cursor-pointer text-xs py-2 px-3 rounded hover:bg-gray-100 mb-1 border-b";
                    li.textContent = item.title.length > 30 ? item.title.slice(0, 28) + '...' : item.title;
                    li.addEventListener('click', () => loadChat(idx));
                    chatHistoryList.appendChild(li);
                });
            }
            function saveChat(title, answerHtml, sources=[]) {
                chatHistory.push({ title, answerHtml, sources, ts: Date.now() });
                localStorage.setItem('vlsiChatHistory', JSON.stringify(chatHistory));
                updateChatHistory();
            }
            function loadChat(idx) {
                const chat = chatHistory[idx];
                if (!chat) return;
                document.getElementById('analysisOutput').innerHTML = chat.answerHtml;
                document.getElementById('resultContainer').classList.remove('hidden');
            }
            updateChatHistory();

            // Help & Contact Popups
            document.getElementById('helpTab').onclick = () => { document.getElementById('helpPopup').classList.remove('hidden'); };
            document.getElementById('contactTab').onclick = () => { document.getElementById('contactPopup').classList.remove('hidden'); };
            document.getElementById('closeHelpBtn').onclick = () => { document.getElementById('helpPopup').classList.add('hidden'); };
            document.getElementById('closeContactBtn').onclick = () => { document.getElementById('contactPopup').classList.add('hidden'); };

            // Speech Input (Voice)
            function voiceToTextarea(btn, textarea) {
                if (!('webkitSpeechRecognition' in window)) {
                    showMessage("Speech recognition not available in this browser");
                    return;
                }
                const recognition = new webkitSpeechRecognition();
                recognition.lang = 'en-US';
                recognition.interimResults = false;
                btn.textContent = 'üé§ Listening...';
                recognition.start();
                recognition.onresult = (evt) => {
                    textarea.value = (textarea.value ? textarea.value + " " : "") + evt.results.transcript;
                    btn.textContent = 'üé§ Speak';
                };
                recognition.onerror = () => { btn.textContent = 'üé§ Speak'; };
                recognition.onend = () => { btn.textContent = 'üé§ Speak'; };
            }
            document.getElementById('vlsiMicBtn').onclick = () => voiceToTextarea(document.getElementById('vlsiMicBtn'), document.getElementById('vlsiInput'));
            document.getElementById('logMicBtn').onclick = () => voiceToTextarea(document.getElementById('logMicBtn'), document.getElementById('logInput'));
            document.getElementById('codeMicBtn').onclick = () => voiceToTextarea(document.getElementById('codeMicBtn'), document.getElementById('codeInput'));
            document.getElementById('reportMicBtn').onclick = () => voiceToTextarea(document.getElementById('reportMicBtn'), document.getElementById('reportInput'));
            document.getElementById('diagramMicBtn').onclick = () => voiceToTextarea(document.getElementById('diagramMicBtn'), document.getElementById('diagramInput'));

            // File Attachments
            function fileToTextarea(inputId, textareaId) {
                const input = document.getElementById(inputId);
                input.onchange = function() {
                    const file = input.files;
                    if (file && file.type.includes('image')) {
                        const reader = new FileReader();
                        reader.onload = (evt) => {
                            textareaId.value += `\n[Image inserted]\n`;
                        };
                        reader.readAsDataURL(file);
                    } else if (file && file.type === 'application/pdf') {
                        textareaId.value += `\n[PDF inserted]\nFilename: ${file.name}`;
                    }
                };
            }
            fileToTextarea('vlsiFileInput', document.getElementById('vlsiInput'));
            fileToTextarea('logFileInput', document.getElementById('logInput'));
            fileToTextarea('codeFileInput', document.getElementById('codeInput'));
            fileToTextarea('reportFileInput', document.getElementById('reportInput'));
            fileToTextarea('diagramFileInput', document.getElementById('diagramInput'));

            // API Call Gemini (replace with own backend if preferred)
            async function callGemini(systemPrompt, userQuery, mode='generic') {
                document.getElementById('loadingIndicator').classList.remove('hidden');
                document.getElementById('resultContainer').classList.add('hidden');
                document.getElementById('analysisOutput').innerHTML = '';
                try {
                    const apiKey = "AIzaSyDok7jTaB2sK8_Dtmh195ATjrONPxiHOgo";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                    const payload = {
                        contents: [{ parts: [{ text: userQuery }] }],
                        systemInstruction: {
                            parts: [{ text: systemPrompt }]
                        },
                    };
                    const response = await fetch(apiUrl, {
                        method: 'POST', headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const result = await response.json();
                    const candidate = result.candidates?.;
                    let sources = [];
                    let answerText = '';
                    if (candidate && candidate.content?.parts?.?.text) {
                        answerText = candidate.content.parts.text;
                        // Look for explicit 'Source:' patterns
                        let sourceMatch = answerText.match(/Source:\s*\[(.*?)\]/gi);
                        if (sourceMatch) {
                            sources = sourceMatch.map(x => x.replace('Source:','').replace('[','').replace(']',''));
                        }
                        let answerHtml = marked.parse(answerText);
                        if (sources.length) {
                            answerHtml += `<div class="mt-3 text-xs text-gray-500">Sources: ${sources.map(s=>`<a href="${s.trim()}" target="_blank" class="text-blue-700 underline">${s.trim()}</a>`).join(', ')}</div>`;
                        }
                        document.getElementById('analysisOutput').innerHTML = answerHtml;
                        document.getElementById('resultContainer').classList.remove('hidden');
                        saveChat(userQuery, answerHtml, sources);
                    } else {
                        showMessage('No analysis could be generated. Please try again.');
                    }
                } catch (error) {
                    showMessage(`An error occurred: ${error.message}`);
                } finally {
                    document.getElementById('loadingIndicator').classList.add('hidden');
                }
            }

            // Button Actions
            document.getElementById('vlsiSubmitBtn').onclick = () => {
                const vlsiQ = document.getElementById('vlsiInput').value.trim();
                if (!vlsiQ) { showMessage('Please ask a VLSI question!'); return; }
                const sysPrompt = `You are a world-class VLSI teaching assistant. The user will ask a question about VLSI, DV, PD or related concepts, possibly uploading images/PDFs or speaking. Respond at a level suited to the question: for simple queries reply in point form; for complex, reply with rich explanation and formatted sections. Clearly cite your web sources.`;
                callGemini(sysPrompt, vlsiQ, 'vlsi');
            };
            document.getElementById('analyzeLogButton').onclick = () => {
                const logQ = document.getElementById('logInput').value.trim();
                if (!logQ) { showMessage('Please paste a log to analyze.'); return;}
                const sysPrompt = `You are a world-class VLSI log analysis expert. Analyze the log (with possible image/pdf attachments/context). Break down errors/warnings with simple explanations, and source each fix/diagnosis.`;
                callGemini(sysPrompt, logQ, 'log');
            };
            document.getElementById('optimizeCodeButton').onclick = () => {
                const codeQ = document.getElementById('codeInput').value.trim();
                if (!codeQ) { showMessage('Paste VLSI code to optimize or describe intent.'); return;}
                const sysPrompt = `You are a VLSI code optimization expert. Analyze the provided Verilog/VHDL/code intent, suggest area/power/timing improvements, and provide code changes. Cite synthesis/EDA sources for suggestions. For simple changes, show in bullet points.`;
                callGemini(sysPrompt, codeQ, 'code-opt');
            };
            document.getElementById('generateCodeButton').onclick = () => {
                const codeQ = document.getElementById('codeInput').value.trim();
                if (!codeQ) { showMessage('Describe the circuit or logic to generate code.'); return;}
                const sysPrompt = `You are a VLSI code generator. Generate optimized Verilog/VHDL for the user's design request (text/pasted/speech/attachment). Clearly explain the logic. Attribute any online design references.`;
                callGemini(sysPrompt, codeQ, 'code-gen');
            };
            document.getElementById('summarizeReportButton').onclick = () => {
                const reportQ = document.getElementById('reportInput').value.trim();
                if (!reportQ) { showMessage('Paste a report for summary.'); return;}
                const sysPrompt = `You are a professional VLSI verification and signoff expert. Summarize the timing/power/other report, highlighting top metrics, warnings, and pass/fail. Display source files/sites for every main detail.`;
                callGemini(sysPrompt, reportQ, 'report');
            };
            document.getElementById('diagramGenBtn').onclick = () => {
                const diagQ = document.getElementById('diagramInput').value.trim();
                if (!diagQ) { showMessage('Describe or attach a diagram request.'); return;}
                const sysPrompt = `You are a VLSI diagram assistant. For the user's block diagram request/input/attachment, generate or explain the diagram. Provide source citations for any technical references.`;
                callGemini(sysPrompt, diagQ, 'diagram');
            };
        });

    </script>
</body>
</html>
