<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VLSI AI Assistant ‚Äî Enhanced</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; margin:0; background:#f8f6f0; }
    .glass { background: rgba(255,255,255,0.85); backdrop-filter: blur(6px); }
    .message-box{ position:fixed; top:20px; left:50%; transform:translateX(-50%); padding:0.75rem 1rem; border-radius:0.5rem; box-shadow:0 6px 18px rgba(0,0,0,0.12); z-index:60; display:none }
    .message-box.show{ display:block }
    /* Left panel sizing */
    .left-width{ width: 320px; }
    /* Canvas background fits behind everything */
    #bgCanvas{ position:fixed; inset:0; z-index:-10; }
    /* small file previews */
    .file-thumb{ max-width:100%; max-height:140px; border-radius:6px; border:1px solid #eee }
    .history-item{ cursor:pointer }
  </style>
</head>
<body class="min-h-screen flex items-start justify-center p-6">

  <canvas id="bgCanvas"></canvas>

  <div id="messageBox" class="message-box glass text-red-700"></div>

  <div class="flex w-full max-w-6xl gap-6">

    <!-- Left: FAQ + Chat history -->
    <aside class="left-width glass rounded-xl p-4 shadow-md sticky top-6 self-start h-[80vh] overflow-auto">
      <h2 class="text-xl font-semibold mb-2">VLSI Quick Queries</h2>
      <p class="text-sm text-gray-600 mb-3">Tap any topic for a short easy-to-understand explainer ‚Äî answers adapt to complexity.</p>
      <div id="vlsiFaq" class="space-y-2">
        <!-- populated by JS -->
      </div>

      <hr class="my-4">
      <div class="flex items-center justify-between">
        <h3 class="font-semibold">Chat History</h3>
        <button id="clearHistory" class="text-xs text-red-600">Clear</button>
      </div>
      <div id="chatHistory" class="mt-2 space-y-2 text-sm text-gray-700"></div>

      <div class="mt-5 text-xs text-gray-600">Help & Contact</div>
      <div class="mt-2 flex flex-col gap-2 text-sm">
        <button id="helpBtn" class="text-left p-2 rounded hover:bg-gray-100">Help</button>
        <button id="contactBtn" class="text-left p-2 rounded hover:bg-gray-100">Contact</button>
      </div>
    </aside>

    <!-- Main content -->
    <main class="flex-1 glass rounded-xl p-6 shadow-md">
      <header class="flex items-center justify-between mb-4">
        <div>
          <h1 class="text-2xl font-bold">VLSI AI Assistant</h1>
          <p class="text-sm text-gray-600">Design analysis, code optimizer & generator, report summarizer ‚Äî friendly & source-aware.</p>
        </div>
        <div class="flex items-center gap-3">
          <button id="speakToggle" title="Speak your question" class="px-3 py-2 rounded-lg border">üéôÔ∏è Speak</button>
          <button id="ttsToggle" title="Read response aloud" class="px-3 py-2 rounded-lg border">üîä Read</button>
          <button id="newChat" class="bg-blue-600 text-white px-3 py-2 rounded-lg">New Chat</button>
        </div>
      </header>

      <!-- Tabs -->
      <div>
        <nav class="flex gap-2 mb-4">
          <button class="tabBtn px-4 py-2 rounded-md bg-blue-50" data-tab="vlsi">VLSI Q&A</button>
          <button class="tabBtn px-4 py-2 rounded-md" data-tab="logs">Log Analyzer</button>
          <button class="tabBtn px-4 py-2 rounded-md" data-tab="code">Code (Optimize & Generate)</button>
          <button class="tabBtn px-4 py-2 rounded-md" data-tab="report">Report Summarizer</button>
          <button class="tabBtn px-4 py-2 rounded-md" data-tab="diagram">Diagram Generator</button>
        </nav>

        <div id="tabContent">
          <!-- VLSI Q&A -->
          <section id="panel-vlsi" class="tabPanel">
            <div class="mb-3 text-sm text-gray-600">Quick description: Ask conceptual VLSI queries (e.g., "What is Physical Design?" or "Difference between DFT and DV"). For best results, say what level you want (beginner/intermediate/advanced).</div>
            <textarea id="vlsiInput" rows="4" class="w-full p-3 border rounded-md" placeholder="Type your VLSI question here... (or use the Speak button)"></textarea>
            <div class="flex gap-2 mt-3">
              <input id="vlsiFile" type="file" accept="image/*,.pdf" class="hidden">
              <button id="attachVlsi" class="px-4 py-2 border rounded">üìé Attach Image/PDF</button>
              <select id="vlsiLevel" class="px-3 py-2 border rounded">
                <option value="auto">Auto complexity</option>
                <option value="beginner">Beginner</option>
                <option value="intermediate">Intermediate</option>
                <option value="advanced">Advanced</option>
              </select>
              <button id="askVlsiBtn" class="ml-auto bg-blue-600 text-white px-4 py-2 rounded">Ask</button>
            </div>
          </section>

          <!-- Log Analyzer -->
          <section id="panel-logs" class="tabPanel hidden">
            <div class="mb-3 text-sm text-gray-600">Short description: Paste a log (or upload a .txt/.log/.gz). Include what you ran (tool + command) for more contextual answers.</div>
            <textarea id="logInput" rows="8" class="w-full p-3 border rounded-md" placeholder="Paste VLSI logs here..."></textarea>
            <div class="flex gap-2 mt-3">
              <input id="logFile" type="file" accept=".txt,.log,.gz" class="hidden">
              <button id="attachLog" class="px-4 py-2 border rounded">üìé Attach Log</button>
              <button id="analyzeLog" class="ml-auto bg-blue-600 text-white px-4 py-2 rounded">Analyze Log</button>
            </div>
          </section>

          <!-- Code -->
          <section id="panel-code" class="tabPanel hidden">
            <div class="mb-3 text-sm text-gray-600">Short description: Paste Verilog/VHDL for optimization, or request code generation (be specific: module name, inputs, desired constraints: area/timing/power).</div>
            <textarea id="codeInput" rows="10" class="w-full p-3 border rounded-md" placeholder="Paste code or describe the module you'd like generated (e.g., "32-bit RISC ALU with add/sub/mul")"></textarea>
            <div class="flex gap-2 mt-3">
              <select id="codeGoal" class="px-3 py-2 border rounded">
                <option value="balanced">Balanced (area/timing)</option>
                <option value="area">Minimize Area</option>
                <option value="timing">Optimize Timing</option>
                <option value="power">Low Power</option>
              </select>
              <input id="codeFiles" type="file" accept=".v,.sv,.vh,.vhdl" class="hidden" multiple>
              <button id="attachCode" class="px-4 py-2 border rounded">üìé Attach Code</button>
              <button id="optimizeCode" class="ml-auto bg-purple-600 text-white px-4 py-2 rounded">Optimize / Generate</button>
            </div>
          </section>

          <!-- Report -->
          <section id="panel-report" class="tabPanel hidden">
            <div class="mb-3 text-sm text-gray-600">Short description: Paste timing/power/area reports. For best results include the tool & corner (e.g., "PrimeTime - setup 3.3V 125C")</div>
            <textarea id="reportInput" rows="8" class="w-full p-3 border rounded-md" placeholder="Paste report content here..."></textarea>
            <div class="flex gap-2 mt-3">
              <input id="reportFile" type="file" accept=".txt,.rpt,.pdf" class="hidden">
              <button id="attachReport" class="px-4 py-2 border rounded">üìé Attach Report</button>
              <button id="summarizeReport" class="ml-auto bg-green-600 text-white px-4 py-2 rounded">Summarize</button>
            </div>
          </section>

          <!-- Diagram generator -->
          <section id="panel-diagram" class="tabPanel hidden">
            <div class="mb-3 text-sm text-gray-600">Short description: Describe the diagram (block diagram, floorplan, clock tree). You can attach sketches or reference images.</div>
            <textarea id="diagramInput" rows="5" class="w-full p-3 border rounded-md" placeholder="Describe diagram you'd like generated..."></textarea>
            <div class="flex gap-2 mt-3">
              <input id="diagramFile" type="file" accept="image/*,.pdf" class="hidden">
              <button id="attachDiagram" class="px-4 py-2 border rounded">üìé Attach Image</button>
              <button id="genDiagram" class="ml-auto bg-indigo-600 text-white px-4 py-2 rounded">Generate Diagram</button>
            </div>
          </section>

        </div>

        <!-- Result area -->
        <div id="resultArea" class="mt-6 p-4 bg-gray-50 rounded-md border hidden">
          <div class="flex items-start justify-between">
            <div>
              <h3 id="resultTitle" class="font-semibold text-lg">Analysis Result</h3>
              <div id="resultMeta" class="text-xs text-gray-500 mt-1"></div>
            </div>
            <div class="flex items-center gap-2">
              <button id="copyResult" class="px-3 py-1 border rounded">Copy</button>
              <button id="saveChat" class="px-3 py-1 border rounded">Save</button>
            </div>
          </div>
          <hr class="my-3">
          <div id="resultOutput" class="prose max-w-none text-gray-800"></div>
          <div id="resultSources" class="mt-3 text-sm text-gray-600"></div>
        </div>

      </div>

    </main>

  </div>

  <!-- Contact Modal (hidden) -->
  <div id="contactModal" class="fixed inset-0 bg-black/40 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-xl p-6 w-full max-w-md">
      <h3 class="text-lg font-semibold">Contact</h3>
      <p class="text-sm text-gray-600 mt-2">Professional contact for the VLSI AI Assistant.</p>
      <div class="mt-4 text-sm">
        <div><strong>Name:</strong> Ashray Datta Pranesh Anegondi</div>
        <div class="mt-1"><strong>Email:</strong> apranesh03@gmail.com</div>
        <div class="mt-3 text-gray-500 text-xs">(You can update these details in the code to show real contact info.)</div>
      </div>
      <div class="mt-6 text-right">
        <button id="closeContact" class="px-4 py-2 rounded border">Close</button>
      </div>
    </div>
  </div>

  <!-- Help Modal -->
  <div id="helpModal" class="fixed inset-0 bg-black/40 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-xl p-6 w-full max-w-lg">
      <h3 class="text-lg font-semibold">Quick Help</h3>
      <ul class="mt-3 text-sm list-disc ml-5 space-y-1 text-gray-700">
        <li>Use the left-side VLSI Quick Queries to get instant concept answers (complexity adapts automatically).</li>
        <li>Attach images or PDFs when you can't paste ‚Äî the assistant will include them in the context.</li>
        <li>Click "Save" on a result to preserve it in chat history. Use the history items to navigate previous chats.</li>
      </ul>
      <div class="mt-6 text-right">
        <button id="closeHelp" class="px-4 py-2 rounded border">Close</button>
      </div>
    </div>
  </div>

  <script>
  // ---------------------------
  // Background: moving balls with color influence
  // ---------------------------
  const canvas = document.getElementById('bgCanvas');
  const ctx = canvas.getContext('2d');
  let W, H; function resize(){ W=canvas.width=innerWidth; H=canvas.height=innerHeight }
  addEventListener('resize', resize); resize();

  class Ball{ constructor(){ this.reset(); }
    reset(){ this.r = 30 + Math.random()*80; this.x = Math.random()*W; this.y = Math.random()*H; this.vx = (Math.random()-0.5)*0.6; this.vy = (Math.random()-0.5)*0.6; this.h = Math.floor(Math.random()*360); this.s=60; this.l=60; }
    step(){ this.x += this.vx; this.y += this.vy; if(this.x<-this.r) this.x = W+this.r; if(this.x>W+this.r) this.x=-this.r; if(this.y<-this.r) this.y = H+this.r; if(this.y>H+this.r) this.y=-this.r }
    draw(){ ctx.beginPath(); const grd = ctx.createRadialGradient(this.x,this.y,this.r*0.1,this.x,this.y,this.r); grd.addColorStop(0, `hsla(${this.h}, ${this.s}%, ${this.l}%, 0.9)`); grd.addColorStop(1, `hsla(${this.h}, ${this.s}%, ${this.l}%, 0.15)`); ctx.fillStyle = grd; ctx.arc(this.x,this.y,this.r,0,Math.PI*2); ctx.fill(); }
  }
  const balls = Array.from({length:6}, ()=>new Ball());
  function animate(){ ctx.clearRect(0,0,W,H); // cream-ish background overlay subtle
    ctx.fillStyle = 'rgba(253,250,244,0.5)'; ctx.fillRect(0,0,W,H);
    balls.forEach(b=>{ b.step(); b.draw(); }); requestAnimationFrame(animate); }
  animate();

  // ---------------------------
  // Simple UI behavior & chat history (localStorage)
  // ---------------------------
  const faq = [
    {q:'What is VLSI?', a:'VLSI (Very-Large-Scale Integration) is the process of creating integrated circuits by combining thousands to billions of transistors on a single chip.'},
    {q:'What is Physical Design?', a:'Physical Design converts a synthesized netlist into a geometric representation ‚Äî placement, routing, and final GDSII output.'},
    {q:'What is Design Verification (DV)?', a:'Design Verification ensures the design matches the specification using simulation, formal methods, and equivalence checking.'},
    {q:'What is Static Timing Analysis (STA)?', a:'STA checks timing paths in the design without simulation by analyzing delays across cells and interconnects.'},
    {q:'What is DFT?', a:'Design-for-Testability (DFT) adds structures to help manufacturing testing ‚Äî e.g., scan chains, BIST.'}
  ];

  const vlsiFaqDiv = document.getElementById('vlsiFaq');
  faq.forEach((f,i)=>{
    const btn = document.createElement('button'); btn.className='w-full text-left p-2 rounded hover:bg-gray-50 history-item';
    btn.innerHTML = `<strong>${f.q}</strong><div class='text-xs text-gray-500'>Tap for short/long explainer</div>`;
    btn.addEventListener('click', ()=>{ document.getElementById('vlsiInput').value = f.q; selectTab('vlsi'); });
    vlsiFaqDiv.appendChild(btn);
  });

  // Tabs
  function selectTab(id){ document.querySelectorAll('.tabBtn').forEach(b=>b.classList.remove('bg-blue-50')); document.querySelector(`[data-tab="${id}"]`).classList.add('bg-blue-50'); document.querySelectorAll('.tabPanel').forEach(p=>p.classList.add('hidden')); document.getElementById('panel-'+id).classList.remove('hidden'); }
  document.querySelectorAll('.tabBtn').forEach(b=> b.addEventListener('click', ()=> selectTab(b.dataset.tab)) );

  // Chat history functions
  function loadHistory(){ return JSON.parse(localStorage.getItem('vlsi_chats')||'[]'); }
  function saveHistory(arr){ localStorage.setItem('vlsi_chats', JSON.stringify(arr)); }
  function renderHistory(){ const c = loadHistory(); const el = document.getElementById('chatHistory'); el.innerHTML=''; c.slice().reverse().forEach((item,idx)=>{ const div = document.createElement('div'); div.className='p-2 rounded hover:bg-gray-100 history-item'; div.innerHTML = `<div class='font-medium'>${item.title||'Saved Chat'}</div><div class='text-xs text-gray-500 mt-1'>${new Date(item.date).toLocaleString()}</div>`; div.addEventListener('click', ()=>{ loadChat(item); }); el.appendChild(div); }); }
  function addHistoryItem(title, input, output, sources){ const h = loadHistory(); h.push({title, input, output, sources, date:Date.now()}); saveHistory(h); renderHistory(); }
  function loadChat(item){ // show in result area
    document.getElementById('resultArea').classList.remove('hidden'); document.getElementById('resultTitle').textContent = item.title||'Saved Chat'; document.getElementById('resultOutput').innerHTML = item.output; document.getElementById('resultSources').innerHTML = item.sources ? '<strong>Sources:</strong> '+item.sources.map(s=>`<a class="underline" href="#" data-src="${s}">${s}</a>`).join(', ') : ''; }

  renderHistory();
  document.getElementById('clearHistory').addEventListener('click', ()=>{ if(confirm('Clear all saved chats?')){ localStorage.removeItem('vlsi_chats'); renderHistory(); } });

  // Help & contact
  document.getElementById('helpBtn').addEventListener('click', ()=> document.getElementById('helpModal').classList.remove('hidden') );
  document.getElementById('contactBtn').addEventListener('click', ()=> document.getElementById('contactModal').classList.remove('hidden') );
  document.getElementById('closeHelp').addEventListener('click', ()=> document.getElementById('helpModal').classList.add('hidden') );
  document.getElementById('closeContact').addEventListener('click', ()=> document.getElementById('contactModal').classList.add('hidden') );

  // Attach buttons to file inputs
  document.getElementById('attachVlsi').addEventListener('click', ()=>document.getElementById('vlsiFile').click());
  document.getElementById('attachLog').addEventListener('click', ()=>document.getElementById('logFile').click());
  document.getElementById('attachCode').addEventListener('click', ()=>document.getElementById('codeFiles').click());
  document.getElementById('attachReport').addEventListener('click', ()=>document.getElementById('reportFile').click());
  document.getElementById('attachDiagram').addEventListener('click', ()=>document.getElementById('diagramFile').click());

  // Speak input: Web Speech API
  let recog=null, speaking=false;
  if('webkitSpeechRecognition' in window || 'SpeechRecognition' in window){ const SR = window.SpeechRecognition || window.webkitSpeechRecognition; recog = new SR(); recog.continuous=false; recog.lang='en-IN'; recog.interimResults=false; recog.onresult = (e)=>{ const text = e.results[0][0].transcript; document.activeElement.value = (document.activeElement.value?document.activeElement.value+' ':'') + text; showMessage('Captured speech input', 'success'); } }
  document.getElementById('speakToggle').addEventListener('click', ()=>{ if(!recog){ showMessage('Speech recognition not supported in this browser.'); return; } if(!speaking){ recog.start(); speaking=true; document.getElementById('speakToggle').textContent='üéôÔ∏è Listening...'; } else { recog.stop(); speaking=false; document.getElementById('speakToggle').textContent='üéôÔ∏è Speak'; } });

  // TTS toggle
  let ttsEnabled=false; document.getElementById('ttsToggle').addEventListener('click', ()=>{ ttsEnabled = !ttsEnabled; document.getElementById('ttsToggle').textContent = ttsEnabled? 'üîä Read (on)':'üîä Read'; showMessage('TTS '+(ttsEnabled?'enabled':'disabled'),'success'); });

  // Copy & Save result
  document.getElementById('copyResult').addEventListener('click', ()=>{ const txt = document.getElementById('resultOutput').innerText; navigator.clipboard.writeText(txt).then(()=>showMessage('Copied result to clipboard','success')); });
  document.getElementById('saveChat').addEventListener('click', ()=>{ const title = prompt('Title for this saved chat','VLSI chat'); const input = lastInput||''; const output = document.getElementById('resultOutput').innerHTML; const sources = lastSources||[]; if(title) addHistoryItem(title, input, output, sources); showMessage('Chat saved','success'); });

  // Simple result renderer and placeholder API call (keeps existing Gemini call pattern but shows sources if present)
  let lastInput='', lastSources=[];
  async function fakeCall(systemPrompt, userQuery, options={}){
    // This function emulates calling a language model. For production, replace with real API call and ensure returned object includes .answer and .sources (array of urls)
    document.getElementById('resultArea').classList.remove('hidden'); document.getElementById('resultTitle').textContent = options.title||'Result';
    document.getElementById('resultMeta').textContent = 'Processing...';
    // lightweight complexity detection
    const complexity = options.level || 'auto';
    await new Promise(r=>setTimeout(r,800));
    // Example simple behavior: if question short => points; if long => descriptive
    const simple = userQuery.length < 220 || complexity==='beginner';
    let answer = '';
    if(simple){ answer = '- **Short answer:** This is a concise explanation tailored for quick understanding.\n\n- **Steps / Points:**\n  - Point 1\n  - Point 2\n  - Suggested fix (if applicable)\n'; }
    else { answer = `### Detailed Explanation\n\nHere is a descriptive, example explanation for: **${userQuery.slice(0,90)}...**\n\n1. Background and context\n\n2. Technical details and reasoning\n\n3. Practical suggestions and example snippets\n`; }
    // Fake sources (in real response, parse sources from API)
    const sources = options.addSources || ['https://example.com/vlsi-intro','https://example.com/physical-design'];
    lastInput = userQuery; lastSources = sources;
    document.getElementById('resultMeta').textContent = `Query length: ${userQuery.length} chars ‚Ä¢ Complexity: ${complexity}`;
    document.getElementById('resultOutput').innerHTML = marked.parse(answer);
    document.getElementById('resultSources').innerHTML = sources.length ? '<strong>Sources:</strong> '+sources.map(s=>`<a class="underline" href="${s}" target="_blank">${s}</a>`).join(', ') : '';
    if(ttsEnabled){ const u = new SpeechSynthesisUtterance(document.getElementById('resultOutput').innerText); speechSynthesis.speak(u); }
  }

  // Hook buttons to fakeCall (replace with real API integration as needed)
  document.getElementById('askVlsiBtn').addEventListener('click', ()=>{
    const q = document.getElementById('vlsiInput').value.trim(); const lvl = document.getElementById('vlsiLevel').value;
    if(!q){ showMessage('Please type or speak a VLSI question.'); return; }
    fakeCall('VLSI expert system', q, {level:lvl, title:'VLSI Q&A', addSources:['https://en.wikipedia.org/wiki/VLSI','https://www.eeweb.com/what-is-physical-design/']});
  });

  document.getElementById('analyzeLog').addEventListener('click', ()=>{
    const q = document.getElementById('logInput').value.trim(); if(!q){ showMessage('Paste or attach a log file first.'); return; }
    fakeCall('VLSI Log analyzer', q, {level:'auto', title:'Log Analysis', addSources:['https://example.com/log-format']});
  });

  document.getElementById('optimizeCode').addEventListener('click', ()=>{
    const q = document.getElementById('codeInput').value.trim(); const goal = document.getElementById('codeGoal').value;
    if(!q){ showMessage('Paste code or describe the module to generate.'); return; }
    fakeCall('VLSI code optimizer & generator', q, {level:'auto', title:'Code Optimization / Generation', addSources:['https://developer.cadence.com','https://www.synopsys.com']});
  });

  document.getElementById('summarizeReport').addEventListener('click', ()=>{
    const q = document.getElementById('reportInput').value.trim(); if(!q){ showMessage('Paste a report or attach a file.'); return; }
    fakeCall('Design report summarizer', q, {level:'auto', title:'Report Summary', addSources:['https://example.com/pt-report']});
  });

  document.getElementById('genDiagram').addEventListener('click', ()=>{
    const q = document.getElementById('diagramInput').value.trim(); if(!q){ showMessage('Describe the diagram you want.'); return; }
    fakeCall('Diagram generator', q, {level:'auto', title:'Diagram Generation', addSources:['https://example.com/diagram-tools']});
  });

  // File previews (simple) ‚Äî display names and small thumbnail for images
  function handleFileInput(fileInput, targetTextarea){ fileInput.addEventListener('change', (e)=>{ const f = e.target.files[0]; if(!f) return; const reader = new FileReader(); if(f.type.startsWith('image/')){ reader.onload = ()=>{ showMessage('Image attached','success'); document.getElementById('resultArea').classList.remove('hidden'); document.getElementById('resultOutput').innerHTML = `<img src="${reader.result}" class='file-thumb'/>`; }; reader.readAsDataURL(f); } else { reader.onload = ()=>{ showMessage('File attached','success'); document.getElementById('resultArea').classList.remove('hidden'); document.getElementById('resultOutput').innerText = `Attached file: ${f.name}\n---\n` + reader.result.slice(0,200) + '\n...'; }; reader.readAsText(f); } }); }
  handleFileInput(document.getElementById('vlsiFile'));
  handleFileInput(document.getElementById('logFile'));
  handleFileInput(document.getElementById('codeFiles'));
  handleFileInput(document.getElementById('reportFile'));
  handleFileInput(document.getElementById('diagramFile'));

  // Utility: show message
  function showMessage(msg, type='error'){ const mb = document.getElementById('messageBox'); mb.textContent = msg; mb.className = 'message-box show '+(type==='error'?'text-red-700 bg-red-100':'text-green-700 bg-green-100'); setTimeout(()=> mb.classList.remove('show'),4000); }

  // New Chat clears inputs but keeps history
  document.getElementById('newChat').addEventListener('click', ()=>{ document.querySelectorAll('textarea').forEach(t=>t.value=''); document.getElementById('resultArea').classList.add('hidden'); showMessage('New chat started','success'); });

  // small helper to open source links from saved chat
  document.getElementById('resultSources').addEventListener('click', (e)=>{ if(e.target.matches('a')){ window.open(e.target.href,'_blank'); } });

  // Expose marked (loaded from CDN earlier) fallback in case not present
  if(typeof marked === 'undefined') window.marked = { parse: (t)=> t };

  </script>

</body>
</html>
